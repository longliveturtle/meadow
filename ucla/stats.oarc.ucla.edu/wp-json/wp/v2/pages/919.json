{"id":919,"date":"2016-02-11T18:29:03","date_gmt":"2016-02-11T18:29:03","guid":{"rendered":"http:\/\/dev2.hpc.ucla.edu\/r\/dae-3\/r-data-analysis-examples-exact-logistic-regression\/"},"modified":"2017-02-27T15:10:32","modified_gmt":"2017-02-27T23:10:32","slug":"exact-logistic-regression","status":"publish","type":"page","link":"https:\/\/stats.oarc.ucla.edu\/r\/dae\/exact-logistic-regression\/","title":{"rendered":"Exact Logistic Regression |  R Data Analysis Examples"},"content":{"rendered":"<p>Exact logistic regression is used to model binary outcome variables in which the\nlog odds of the outcome is modeled as a linear combination of the predictor\nvariables. It is used when the sample size is too small for a regular\nlogistic regression (which uses the standard maximum-likelihood-based estimator)\nand\/or when some of the cells formed by the outcome and\ncategorical predictor variable have no observations. The estimates given\nby exact logistic regression do not depend on asymptotic results.<\/p>\n<p>This page uses the following packages. Make sure that you can load\nthem before trying to run the examples on this page. If you do not have\na package installed, run: <code>install.packages(\"packagename\")<\/code>, or\nif you see the version is out of date, run: <code>update.packages()<\/code>.<\/p>\n<div id=\"unnamed-chunk-2\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl kwd\">require<\/span>(elrm)\r\n<\/pre>\n<\/div>\n<\/div>\n<\/div>\n<p><code class=\"knitr inline\"><strong>Version info: <\/strong>Code for this page was tested in R version 3.0.1 (2013-05-16)\nOn: 2013-08-06\nWith: elrm 1.2.1; coda 0.16-1; lattice 0.20-15; knitr 1.3\n<\/code><\/p>\n<p><strong>Please note:<\/strong> The purpose of this page is to show how to use various data\nanalysis commands. It does not cover all aspects of the research process which\nresearchers are expected to do. In particular, it does not cover data\ncleaning and checking, verification of assumptions, model diagnostics or\npotential follow-up analyses.<\/p>\n<h2>Example of exact logistic regression<\/h2>\n<p>Suppose that we are interested in the factors\nthat influence whether or not a high school senior is admitted into a very competitive\nengineering school. The outcome variable is binary (0\/1): admit or not admit.\nThe predictor variables of interest include student gender and whether or not the\nstudent took Advanced Placement calculus in high school. Because the response variable is binary, we need\nto use a model that handles 0\/1 outcome variables correctly. Also, because of the number of students\ninvolved is small, we will need a procedure that can perform the estimation with\na small sample size.<\/p>\n<h2>Description of the data<\/h2>\n<p>The data for this exact logistic data analysis include the number of students admitted, the total\nnumber of applicants broken down by gender (the variable <code>female<\/code>), and whether or not\nthey had taken AP calculus (the variable <code>apcalc<\/code>). Since the dataset is so small,\nwe will read it in directly.<\/p>\n<div id=\"unnamed-chunk-3\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\">dat &lt;- <span class=\"hl kwd\">read.table<\/span>(text = \"\r\nfemale  apcalc    admit       num\r\n0        0        0         7\r\n0        0        1         1\r\n0        1        0         3\r\n0        1        1         7\r\n1        0        0         5\r\n1        0        1         1\r\n1        1        0         0\r\n1        1        1         6\",\r\n  header = <span class=\"hl kwa\">TRUE<\/span>)\r\n<\/pre>\n<\/div>\n<\/div>\n<\/div>\n<p>The <code>num<\/code> variable indicates frequency weight. We use this to expand the dataset and\nthen look at some frequency tables.<\/p>\n<div id=\"unnamed-chunk-4\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## expand dataset by repeating each row num times and drop the num<\/span>\r\n<span class=\"hl com\">## variable<\/span>\r\ndat &lt;- dat[<span class=\"hl kwd\">rep<\/span>(1:<span class=\"hl kwd\">nrow<\/span>(dat), dat$num), -4]\r\n\r\n<span class=\"hl com\">## look at various tables<\/span>\r\n<span class=\"hl kwd\">xtabs<\/span>(~female + apcalc, data = dat)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">##       apcalc\r\n## female  0  1\r\n##      0  8 10\r\n##      1  6  6\r\n<\/pre>\n<\/div>\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl kwd\">xtabs<\/span>(~female + admit, data = dat)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">##       admit\r\n## female  0  1\r\n##      0 10  8\r\n##      1  5  7\r\n<\/pre>\n<\/div>\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl kwd\">xtabs<\/span>(~apcalc + admit, data = dat)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">##       admit\r\n## apcalc  0  1\r\n##      0 12  2\r\n##      1  3 13\r\n<\/pre>\n<\/div>\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl kwd\">xtabs<\/span>(~female + apcalc + admit, data = dat)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">## , , admit = 0\r\n## \r\n##       apcalc\r\n## female 0 1\r\n##      0 7 3\r\n##      1 5 0\r\n## \r\n## , , admit = 1\r\n## \r\n##       apcalc\r\n## female 0 1\r\n##      0 1 7\r\n##      1 1 6\r\n<\/pre>\n<\/div>\n<\/div>\n<\/div>\n<p>The tables reveal that 30 students applied for the Engineering program. Of\nthose, 15 were admitted and 15 were denied admission. There were 18 male and 12\nfemale applicants. Sixteen of the applicants had taken AP calculus and 14 had\nnot. Note that all of the females who took AP calculus were admitted, versus only 70% the males.<\/p>\n<h2>Analysis methods you might consider<\/h2>\n<p>Below is a list of some analysis methods you may have\nencountered. Some of the methods listed are quite reasonable, while others have\neither fallen out of favor or have limitations.<\/p>\n<ul>\n<li>Exact logistic regression &#8211; This technique is appropriate because\nthe outcome variable is binary, the sample size is small, and some cells are\nempty.<\/li>\n<li>Regular logistic regression &#8211; Due to the small sample size and the presence of\ncells with no subjects, regular logistic regression is not advisable, and it\nmight not even be estimable.<\/li>\n<li>Two-way contingency tables &#8211; with Fisher&#8217;s exact test due to small expected values.<\/li>\n<\/ul>\n<h2>(Approximate) Exact logistic regression<\/h2>\n<p>Let&#8217;s run an (approximate) exact logistic analysis using the <code>elrm<\/code> command\nin the <code>elrm<\/code> package. This is based on MCMC sampling. It requires a collapsed\ndata set with number of trials and number of successes, so we make that first.<\/p>\n<div id=\"unnamed-chunk-5\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\">x &lt;- <span class=\"hl kwd\">xtabs<\/span>(~admit + <span class=\"hl kwd\">interaction<\/span>(female, apcalc), data = dat)\r\nx  <span class=\"hl com\"># view cross tabs<\/span>\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">##      interaction(female, apcalc)\r\n## admit 0.0 1.0 0.1 1.1\r\n##     0   7   5   3   0\r\n##     1   1   1   7   6\r\n<\/pre>\n<\/div>\n<div class=\"source\">\n<pre class=\"knitr r\">cdat &lt;- cdat &lt;- <span class=\"hl kwd\">data.frame<\/span>(female = <span class=\"hl kwd\">rep<\/span>(0:1, 2), apcalc = <span class=\"hl kwd\">rep<\/span>(0:1, each = 2), \r\n    admit = x[2, ], ntrials = <span class=\"hl kwd\">colSums<\/span>(x))\r\ncdat  <span class=\"hl com\"># view collapsed data set<\/span>\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">##     female apcalc admit ntrials\r\n## 0.0      0      0     1       8\r\n## 1.0      1      0     1       6\r\n## 0.1      0      1     7      10\r\n## 1.1      1      1     6       6\r\n<\/pre>\n<\/div>\n<\/div>\n<\/div>\n<p>Now we can estimate the approximate logistic regression using <code>elrm<\/code> and\nMCMC sampling. We will do 22,000 iterations with a 2,000 burnin for a\nfinal chain of 20,000. Note that for the combined model of female and apcalc, we\nuse a chain of 5 million. This is because for inference, each effect needs at least\n1,000, but because the conditional joint distribution is degenerate, for the female effect\nthe ratio of useable trials is low, meaning that to achieve over 1,000, the total iterations\nmust be extremely high.<\/p>\n<div id=\"unnamed-chunk-6\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## model with female predictor only<\/span>\r\nm.female &lt;- <span class=\"hl kwd\">elrm<\/span>(formula = admit\/ntrials ~ female, interest = ~female, iter = 22000, \r\n    dataset = cdat, burnIn = 2000)\r\n<\/pre>\n<\/div>\n<\/div>\n<\/div>\n<div id=\"unnamed-chunk-7\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## summary of model including estimates and CIs<\/span>\r\n<span class=\"hl kwd\">summary<\/span>(m.female)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">## \r\n## Call:\r\n## [[1]]\r\n## elrm(formula = admit\/ntrials ~ female, interest = ~female, iter = 22000, \r\n##     dataset = cdat, burnIn = 2000)\r\n## \r\n## \r\n## Results:\r\n##        estimate p-value p-value_se mc_size\r\n## female    0.522   0.486    0.00428   20000\r\n## \r\n## 95% Confidence Intervals for Parameters\r\n## \r\n##        lower upper\r\n## female -1.13  2.31\r\n<\/pre>\n<\/div>\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## trace plot and histogram of sampled values from the sufficient<\/span>\r\n<span class=\"hl com\">## statistic<\/span>\r\n<span class=\"hl kwd\">plot<\/span>(m.female)\r\n<\/pre>\n<\/div>\n<\/div>\n<div class=\"rimage default\"><img decoding=\"async\" class=\"plot\" src=\"https:\/\/stats.idre.ucla.edu\/wp-content\/uploads\/2016\/02\/exlogit-unnamed-chunk-7.png\" alt=\"Trace plot and histogram of sampled values for female\" width=\"500px\" height=\"500px\" \/><\/div>\n<\/div>\n<div id=\"unnamed-chunk-8\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## model with apcalc predictor only<\/span>\r\nm.apcalc &lt;- <span class=\"hl kwd\">elrm<\/span>(formula = admit\/ntrials ~ apcalc, interest = ~apcalc, iter = 22000, \r\n    dataset = cdat, burnIn = 2000)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">## \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:   0%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:   5%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  10%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  15%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  20%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  25%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  30%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  35%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  40%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  45%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  50%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  55%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  60%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  65%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  70%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  75%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  80%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  85%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  90%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress:  95%  \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bProgress: 100%\r\n<\/pre>\n<\/div>\n<\/div>\n<\/div>\n<div id=\"unnamed-chunk-9\" class=\"chunk\">\n<div class=\"rcode\">\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## summary of model including estimates and CIs<\/span>\r\n<span class=\"hl kwd\">summary<\/span>(m.apcalc)\r\n<\/pre>\n<\/div>\n<div class=\"output\">\n<pre class=\"knitr r\">## \r\n## Call:\r\n## [[1]]\r\n## elrm(formula = admit\/ntrials ~ apcalc, interest = ~apcalc, iter = 22000, \r\n##     dataset = cdat, burnIn = 2000)\r\n## \r\n## \r\n## Results:\r\n##        estimate p-value p-value_se mc_size\r\n## apcalc     2.86 0.00035    0.00013   20000\r\n## \r\n## 95% Confidence Intervals for Parameters\r\n## \r\n##        lower upper\r\n## apcalc  1.08   Inf\r\n<\/pre>\n<\/div>\n<div class=\"source\">\n<pre class=\"knitr r\"><span class=\"hl com\">## trace plot and histogram of sampled values from the sufficient<\/span>\r\n<span class=\"hl com\">## statistic<\/span>\r\n<span class=\"hl kwd\">plot<\/span>(m.apcalc)\r\n<\/pre>\n<\/div>\n<\/div>\n<div class=\"rimage default\"><img decoding=\"async\" class=\"plot\" src=\"https:\/\/stats.idre.ucla.edu\/wp-content\/uploads\/2016\/02\/exlogit-unnamed-chunk-9.png\" alt=\"Trace plot and histogram of sampled values for apcalc\" width=\"500px\" height=\"500px\" \/><\/div>\n<\/div>\n<pre>## run not automated for time purposes\r\n## results<\/pre>\n<p><img decoding=\"async\" src=\"https:\/\/stats.idre.ucla.edu\/wp-content\/uploads\/2016\/02\/exlogit_female_trace.png\" alt=\"Trace plot of parameters for female\" \/>\n<img decoding=\"async\" src=\"https:\/\/stats.idre.ucla.edu\/wp-content\/uploads\/2016\/02\/exlogit_apcalc_trace.png\" alt=\"Trace plot of parameters for apcalc\" \/><\/p>\n<p>Note that this approximate technique with sufficient burnin and iterations is quite similar with the\n<a href=\"\/stata\/dae\/exact-logistic-regression\/\">exact logistic estimates<\/a> from Stata.<\/p>\n<ul>\n<li>The first part of the output echoes the call used to create the model.\nThe results has three rows, one for the joint distribution, and one for each\nparameter.<\/li>\n<li>The estimate column has the parameter estimates (joint is NA). The next\ncolumn gives the p-values. For the joint row, the p-value is that both effects\nare simultaneously zero. For <code>female<\/code> and <code>apcalc<\/code>, it is the p-value\nfor testing that the individual parameter estimate is zero. Next is the\nMonte Carlo standard errors for the p-value. Finally, mc_size is the length of\nthe Markov chain of sampled values of sufficient statistics used for each parameter\nestimate. Note that all the length of the chain for the joint test was 5 million,\na mere 1,739 for the female parameter. Because each Markov chain needs to be sufficiently\nlong for stable inference, we needed to increase the total chain size to stably estimate female.\nFor apcalc, the chain length is larger than necessary (over 1 million).<\/li>\n<li>below the main results are the confidence intervals for each parameter estimate.<\/li>\n<li>We can also plot each model, to obtain trace plots of the Markov chains.<\/li>\n<\/ul>\n<h2>Things to consider<\/h2>\n<ul>\n<li>Firth logit may be helpful if you have separation in your data. This\ncan be done in R using the <code>logistf<\/code> package.<\/li>\n<li>Exact logistic regression is an alternative to conditional logistic\nregression if you have stratification, since both condition on the number of\npositive outcomes within each stratum. The estimates from these two\nanalyses will be different because a conditional logistic conditions only on the\nintercept term, exact logistic conditions on the sufficient\nstatistics of the other regression parameters as well as the intercept term.<\/li>\n<\/ul>\n<h2>References<\/h2>\n<ul>\n<li>Zamar, D., McNeney, B., and Graham, J. (2007). <i>elrm: Software\nImplementing Exact-like Inference for Logistic Regression Models<\/i>.\n<a href=\"http:\/\/www.jstatsoft.org\/v21\/i03\/paper\">http:\/\/www.jstatsoft.org\/v21\/i03\/paper<\/a><\/li>\n<li>Collett, D. <i>Modeling Binary Data, Second Edition<\/i>. Boca\nRaton: Chapman and Hall.<\/li>\n<li>Cox, D. R. and Snell, E. J. (1989). <i>Analysis of Binary Data, Second\nEdition<\/i>. Boca Raton: Chapman and Hall.<\/li>\n<li>Hirji, K. F. (2005). <i>Exact Analysis of Discrete Data<\/i>. Boca Raton: Chapman\nand Hall.<\/li>\n<\/ul>\n<p><!--?php include \"stat\/footer.htm\"; ?--><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Exact logistic regression is used to model binary outcome variables in which the log odds of the outcome is modeled as a linear combination of the predictor variables. It is&#8230;<br><a class=\"moretag\" href=\"https:\/\/stats.oarc.ucla.edu\/r\/dae\/exact-logistic-regression\/\"> Read More<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"parent":916,"menu_order":1,"comment_status":"closed","ping_status":"closed","template":"","meta":{"_genesis_hide_title":false,"_genesis_hide_breadcrumbs":false,"_genesis_hide_singular_image":false,"_genesis_hide_footer_widgets":false,"_genesis_custom_body_class":"","_genesis_custom_post_class":"","_genesis_layout":"","footnotes":""},"class_list":["post-919","page","type-page","status-publish","entry"],"_links":{"self":[{"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/pages\/919","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/comments?post=919"}],"version-history":[{"count":2,"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/pages\/919\/revisions"}],"predecessor-version":[{"id":26245,"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/pages\/919\/revisions\/26245"}],"up":[{"embeddable":true,"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/pages\/916"}],"wp:attachment":[{"href":"https:\/\/stats.oarc.ucla.edu\/wp-json\/wp\/v2\/media?parent=919"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}